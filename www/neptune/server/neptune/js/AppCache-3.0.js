var AppCache={Initialized:false,Encrypted:"",CurrentUser:"",CurrentUname:"",CurrentApp:"",CurrentConfig:"",PreviousApp:new Array,AppVersion:"",StartApp:"",Url:"",UrlBase:"",Client:"",Passcode:"",Auth:"",enablePasscode:true,enableMocana:false,enableSMP:false,enablePortal:false,enableTwoFactor:false,enableEncryption:false,numPasscode:5,PasscodeApp:"",deviceType:"",deviceID:"",smpApplication:"",xmlString:"",PortalUrl:"",PortalLogoffUrl:"",Load:function(e){e=e.toUpperCase();sap.ui.core.BusyIndicator.show();if(AppCache.CurrentApp){AppCache.PreviousApp.unshift(AppCache.CurrentApp)}AppCache.CurrentApp=e;AppCache.setEnableLogonScreen(false);$.sap.require("jquery.sap.storage");var t=$.sap.storage(jQuery.sap.storage.Type.local);var n="AppCache_"+e;var r=t.get(n);if(r){if(AppCache.Initialized==true){if(typeof AppDestroy=="function"){AppDestroy()}sap.ui.getCore().applyChanges()}var i=!!window.Windows&&/^ms-appx:/.test(location.href);if(i==true){MSApp.execUnsafeLocalFunction(function(){$("#AppCache_Wrapper").html(r).trigger("create");var e=document.getElementById("AppCache_Wrapper");var t=e.getElementsByTagName("script");var n=t[0];var i=n.textContent;$.globalEval(i)})}else{$("#AppCache_Wrapper").html(r).trigger("create")}AppCache.Initialized=true;return}if(modelAppCacheData.getData().length){var s=modelAppCacheData.getData();$.each(s,function(t,n){if(n){if(n.APPLID==e){s.splice(t,1)}}});modelAppCacheData.setData(s);setCacheAppCacheData()}getOnlineAppCacheContent(e)},Update:function(){sap.ui.core.BusyIndicator.show();getOnlineAppCacheData()},Back:function(){if(AppCache.PreviousApp.length>0){if(AppCache.PreviousApp==AppCache.PasscodeApp){AppCache.Lock()}else{AppCache.Load(AppCache.PreviousApp[0])}AppCache.PreviousApp.splice(0,2)}},setEnableCaptchaScreen:function(e){AppCache_boxCaptcha.setVisible(e);AppCache_statusItem.setInfo();setTimeout(function(){AppCache_inCaptcha.focus()},200)},setEnablePasscodeScreen:function(e){AppCache_boxPasscode.setVisible(e);AppCache_statusItem.setInfo();setTimeout(function(){AppCache_inPasscode1.focus()},200)},setEnablePasswordScreen:function(e){AppCache_boxPassword.setVisible(e);AppCache_statusItem.setInfo();setTimeout(function(){AppCache_inPassOld.focus()},200)},setEnableUsersScreen:function(e){AppCache_boxUsers.setVisible(e);AppCache_statusItem.setInfo();AppCacheUsers.removeSelections()},setEnableLogonScreen:function(e){AppCache_boxLogon.setVisible(e);AppCache_statusItem.setInfo();setTimeout(function(){AppCache_inUsername.focus()},200)},Logout:function(){if(AppCache.Initialized==true){if(typeof AppDestroy=="function"){AppDestroy()}}AppCache.setEnableLogonScreen(true);AppCache.setEnablePasscodeScreen(false);AppCache.setEnableUsersScreen(false);AppCache_listStatus.setVisible(true);AppCache.Initialized=false;NumPad.numPasscode=0;NumPad.numValue="";AppCache.Encrypted="";AppCache_inUsername.setValue();setTimeout(function(){AppCache_inUsername.focus()},200);var e;if(AppCache.enablePortal==true){e=AppCache.PortalLogoffUrl}else{e=AppCache.UrlBase+"/neptune/native/neptune_login_ping.html?sap-clearsso2"}$.ajax({type:"GET",url:e,success:function(e,t,n){AppCache_statusItem.setInfo(AppCacheText.userLogout)}});AppCache.Auth="";$.ajaxSetup({headers:{Authorization:AppCache.Auth}});if(AppCache.enableMocana==true){return}if(modelAppCacheUsers.getData().length){AppCache_butSelect.setVisible(true)}},PortalRelog:function(){var e=AppCache.PortalUrl;var t=AppCache.Auth;$.ajax({type:"GET",url:e,data:t,statusCode:{404:function(e){AppCache.Onboard()}},success:function(e,t,n){var r=n.getResponseHeader("SAPLoginStatus");if(r=="null"){if($(e).find("#logonretypepassfield").length>0){r="Password"}else if($(e).find("#logonuidfield").length>0){r="Logon"}}switch(r){case"Logon":AppCache_inPassword.setValue();setTimeout(function(){AppCache_inPassword.focus()},200);return;case"Password":AppCache_statusItem.setInfo(n.getResponseHeader("SAPLoginMessage"));AppCache.setEnablePasswordScreen(true);AppCache.setEnableLogonScreen(false);AppCache.setEnableUsersScreen(false);AppCache_inPassOld.setValue(AppCache_inPassword.getValue());setTimeout(function(){AppCache_inPassNew.focus()},200);return}NumPad.numPasscode=0;NumPad.Clear();NumPad.Verify=true;AppCache.Encrypted=""},error:function(e,t){}})},Logon:function(){AppCache.setEnableLogonScreen(true);if(AppCache_inUsername.getValue()==""){AppCache_statusItem.setInfo(AppCacheText.enterUsername);setTimeout(function(){AppCache_inUsername.focus()},200);return}if(AppCache_inPassword.getValue()==""){AppCache_statusItem.setInfo(AppCacheText.enterPassword);setTimeout(function(){AppCache_inPassword.focus()},200);return}var e;var t;var n=AppCache_inUsername.getValue()+":"+AppCache_inPassword.getValue();var r=Base64.encode(n);AppCache.Auth="Basic "+r;if(AppCache.enablePortal==true){AppCache.Auth="j_user="+AppCache_inUsername.getValue()+"&j_password="+AppCache_inPassword.getValue();e=AppCache.PortalUrl;t=AppCache.Auth}else{var n=AppCache_inUsername.getValue()+":"+AppCache_inPassword.getValue();var r=Base64.encode(n);AppCache.Auth="Basic "+r;$.ajaxSetup({headers:{Authorization:AppCache.Auth,"Access-Control-Allow-Origin":"*"}});t="sap-user="+AppCache_inUsername.getValue()+"&sap-password="+AppCache_inPassword.getValue()+"&sap-client="+AppCache.Client;e=AppCache.UrlBase+"/neptune/native/neptune_login_ping.html?sap-clearsso2"}$.ajax({type:"GET",url:e,data:t,statusCode:{404:function(e){AppCache.Onboard()}},success:function(e,t,n){AppCache_statusItem.setInfo(n.getResponseHeader("SAPLoginMessage"));var r=n.getResponseHeader("SAPLoginStatus");if(AppCache.enablePortal==true){if($(e).find("#logonretypepassfield").length>0){r="Password"}else if($(e).find("#logonuidfield").length>0){r="Logon";AppCache_statusItem.setInfo("Wrong username or password")}}switch(r){case"Logon":AppCache_inPassword.setValue();setTimeout(function(){AppCache_inPassword.focus()},200);return;case"Password":AppCache_statusItem.setInfo(n.getResponseHeader("SAPLoginMessage"));AppCache.setEnablePasswordScreen(true);AppCache.setEnableLogonScreen(false);AppCache.setEnableUsersScreen(false);AppCache_inPassOld.setValue(AppCache_inPassword.getValue());setTimeout(function(){AppCache_inPassNew.focus()},200);return}AppCache_inPassword.setValue();if(AppCache.enableMocana==true){NumPad.Verify=true;AppCache_listStatus.setVisible(false);getOnlineAppCacheUsers(AppCache.CurrentConfig);AppCache.Update();return}if(AppCache.enablePasscode==true){AppCache.setEnablePasscodeScreen(true);AppCache.setEnableLogonScreen(false);AppCache.setEnableUsersScreen(false)}else{NumPad.Verify=true;AppCache_listStatus.setVisible(false);AppCache.Update()}},error:function(e,t){}})},Onboard:function(){AppCache.setEnableLogonScreen(false);AppCache.setEnableCaptchaScreen(true);$.ajax({type:"POST",data:AppCache.xmlString,beforeSend:function(e){e.setRequestHeader("Content-Type","application/atom+xml")},url:AppCache.Url+"/odata/applications/latest/"+AppCache.smpApplication+"/Connections",statusCode:{201:function(){AppCache.Logon()},401:function(e){AppCache_imgCaptcha.setSrc("data:image/jpeg;base64,"+e.responseText)}}})},SetPassword:function(){if(AppCache_inPassNew.getValue()!=AppCache_inPassRepeat.getValue()){AppCache_statusItem.setInfo(AppCacheText.newPasswordNoMatch);AppCache_inPassNew.setValue();AppCache_inPassRepeat.setValue();return}var e="";var t="";if(AppCache.enablePortal==true){t="j_user="+AppCache_inUsername.getValue()+"&j_sap_current_password="+AppCache_inPassOld.getValue()+"&oldPassword="+AppCache_inPassOld.getValue()+"&j_sap_password="+AppCache_inPassNew.getValue()+"&j_password="+AppCache_inPassNew.getValue()+"&confirmNewPassword="+AppCache_inPassRepeat.getValue()+"&j_sap_again="+AppCache_inPassRepeat.getValue();e=AppCache.PortalUrl}else{t="sap-system-login-password="+AppCache_inPassOld.getValue()+"&sap-system-login-passwordnew="+AppCache_inPassNew.getValue()+"&sap-system-login-passwordrepeat="+AppCache_inPassRepeat.getValue()+"&sap-system-login-oninputprocessing=onDoChangePwd"+"&sap-system-login=onContinuePwd"+"&sap-client="+AppCache.Client;e=AppCache.UrlBase+"/neptune/native/neptune_login_ping.html"}$.ajax({type:"GET",url:e,data:t,success:function(e,t,n){AppCache_statusItem.setInfo(n.getResponseHeader("SAPLoginMessage"));AppCache_inPassword.setValue(AppCache_inPassNew.getValue());AppCache_inPassNew.setValue();AppCache_inPassRepeat.setValue();if(AppCache_statusItem.getInfo().length==0){AppCache.setEnablePasswordScreen(false);AppCache.setEnableLogonScreen(true);AppCache.Logon()}}})},Lock:function(){if(AppCache.enableMocana==true){return}var e;if(AppCache.enablePortal==true){e=AppCache.PortalLogoffUrl}else{e=AppCache.UrlBase+"/neptune/native/neptune_login_ping.html?sap-clearsso2"}if(navigator.onLine){$.ajax({type:"GET",url:e,success:function(e,t,n){}})}AppCache.Auth="";$.ajaxSetup({headers:{Authorization:AppCache.Auth}});NumPad.numPasscode=0;NumPad.numValue="";if(AppCache.enableEncryption===true&&AppCache.enablePasscode===true){AppCache.encryptDB()}if(modelAppCacheUsers.getData().length>1){if(typeof AppDestroy=="function"){AppDestroy()}AppCache.setEnableUsersScreen(true)}else{var t=modelAppCacheUsers.getData();AppCache.Encrypted=t[0].AUTH;AppCache.Load(AppCache.PasscodeApp)}},RemoveAllCache:function(){AppCache.Logout();$.sap.require("jquery.sap.storage");var e=$.sap.storage(jQuery.sap.storage.Type.local);e.removeAll();try{AppDB.transaction(function(e){e.executeSql("DROP TABLE model")})}catch(t){console.log("Error processing SQL: "+t.message)}modelAppCacheUsers.setData({});AppCache_butSelect.setVisible(false)},SetPasscode:function(){jQuery.sap.require("sap.m.MessageToast");if(AppCache_inPasscode1.getValue()==""){AppCache_statusItem.setInfo(AppCacheText.enterNewPasscode);setTimeout(function(){AppCache_inPasscode1.focus()},200);return}if(AppCache_inPasscode2.getValue()==""){AppCache_statusItem.setInfo(AppCacheText.enterRepeatPasscode);setTimeout(function(){AppCache_inPasscode2.focus()},200);return}if(AppCache_inPasscode2.getValue().length!=4){AppCache_statusItem.setInfo(AppCacheText.PasscodeToShort);AppCache_inPasscode1.setValue();AppCache_inPasscode2.setValue();setTimeout(function(){AppCache_inPasscode1.focus()},200);return}if(AppCache_inPasscode1.getValue()!=AppCache_inPasscode2.getValue()){AppCache_statusItem.setInfo(AppCacheText.noPasscodeMatch);AppCache_inPasscode1.setValue();AppCache_inPasscode2.setValue();setTimeout(function(){AppCache_inPasscode1.focus()},200);return}AppCache.setEnablePasscodeScreen(false);AppCache.setEnableUsersScreen(false);AppCache_listStatus.setVisible(false);AppCache.Passcode=AppCache_inPasscode1.getValue();AppCache_inPasscode1.setValue();AppCache_inPasscode2.setValue();AppCache.Load(AppCache.PasscodeApp);getOnlineAppCacheUsers(AppCache.CurrentConfig)},genID:function(){var e=(new Date).getTime();var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+Math.random()*16)%16|0;e=Math.floor(e/16);return(t=="x"?n:n&7|8).toString(16)});return t},encryptDB:function(){AppCacheBusyEncrypt.open();try{AppDB.transaction(function(e){e.executeSql("SELECT * FROM model",[],function(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n).KEY;var i=t.rows.item(n).VALUE;if(i.indexOf("[")==0||i.indexOf("{")==0){var s=CryptoJS.AES.encrypt(i,AppCache.deviceID);AppCache.updateDB(r,s.toString())}}AppCacheBusyEncrypt.close()},null)})}catch(e){AppCacheBusyEncrypt.close();console.log("Error processing SQL: "+e.message);return}},decryptDB:function(){AppCacheBusyDecrypt.open();try{AppDB.transaction(function(e){e.executeSql("SELECT * FROM model",[],function(e,t){for(var n=0;n<t.rows.length;n++){var r=t.rows.item(n).KEY;var i=t.rows.item(n).VALUE;if(i.indexOf("[")!=0&&i.indexOf("{")!=0){var s=CryptoJS.AES.decrypt(i,AppCache.deviceID);AppCache.updateDB(r,s.toString(CryptoJS.enc.Utf8))}}AppCacheBusyDecrypt.close()},null)})}catch(e){AppCacheBusyDecrypt.close();console.log("Error processing SQL: "+e.message);return}},updateDB:function(e,t){try{AppDB.transaction(function(n){n.executeSql("INSERT OR REPLACE INTO model (KEY,VALUE) VALUES (?,?)",[e,t])})}catch(n){console.log("Error processing SQL: "+n.message);return}},Startup:function(){if(AppCache.CurrentConfig==""){jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show("No CurrentConfig");return}if(window.openDatabase){if(typeof window.sqlitePlugin=="undefined"){AppDB=window.openDatabase("AppCache","1.0","AppCache",5e7)}else{AppDB=window.sqlitePlugin.openDatabase({name:"AppCache"})}AppDB.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS model (KEY VARCHAR PRIMARY KEY, VALUE VARCHAR)")})}getCacheAppCacheData();getCacheAppCacheUsers();if(AppCache.enableSMP==true){AppCache.UrlBase=AppCache.Url+"/"+AppCache.smpApplication}else{AppCache.UrlBase=AppCache.Url}switch(sap.ui.Device.os.name){case"win":AppCache.deviceType="Windows";break;case"winphone":AppCache.deviceType="WinPhone8";break;case"mac":AppCache.deviceType="iOS";break;case"bb":AppCache.deviceType="Blackberry";break;default:AppCache.deviceType=sap.ui.Device.os.name}AppCache.deviceID=localStorage.getItem("AppCacheID");if(!AppCache.deviceID){AppCache.deviceID=AppCache.genID();localStorage.setItem("AppCacheID",AppCache.deviceID)}AppCache.xmlString='<?xml version="1.0" encoding="utf-8"?>'+'<entry xmlns="http://www.w3.org/2005/Atom" xmlns:d="http://schemas.microsoft.com/ado/2007/08/dataservices" xmlns'+':m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata">'+'<title type="text"/><updated>2012-06-15T02:23:29Z</updated><author><name/>'+'</author><category term="applications.Connection" scheme="http://schemas.microsoft.com/ado/2007/08/dataservices/scheme"/>'+'<content type="application/xml"><m:properties><d:DeviceType>'+AppCache.deviceType+"</d:DeviceType></m:properties></content></entry>";$.ajaxSetup({headers:{"sap-client":AppCache.Client,NeptuneServer:AppCache.UrlBase,"X-SUP-APPCID":AppCache.deviceID}});if(AppCache.enablePasscode==true){if(!modelAppCacheUsers.getData().length){AppCache.setEnableLogonScreen(true);AppCache_listStatus.setVisible(true);return}if(AppCache.enableMocana==true){AppCache.Load(AppCache.StartApp);return}if(modelAppCacheUsers.getData().length>1){AppCache.setEnableUsersScreen(true);AppCacheUsers.removeSelections()}else{var e=modelAppCacheUsers.getData();AppCache.Encrypted=e[0].AUTH;AppCache.CurrentUser=e[0].NAME;AppCache.CurrentUname=e[0].UNAME;AppCache.setEnableLogonScreen(false);AppCache_listStatus.setVisible(false);AppCache.Load(AppCache.PasscodeApp)}}else{AppCache.setEnableLogonScreen(true);AppCache_listStatus.setVisible(true)}}};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t}};var NumPad={numValue:"",Verify:false,numPasscode:0,enterKey:function(e){if(Passcode1.getSelected()==false){Passcode1.setSelected(true);NumPad.numValue=NumPad.numValue+e;return}if(Passcode2.getSelected()==false){Passcode2.setSelected(true);NumPad.numValue=NumPad.numValue+e;return}if(Passcode3.getSelected()==false){Passcode3.setSelected(true);NumPad.numValue=NumPad.numValue+e;return}if(Passcode4.getSelected()==false){Passcode4.setSelected(true);NumPad.numValue=NumPad.numValue+e;butNumpadLogin.setEnabled(true);return}},Clear:function(){NumPad.numValue="";Passcode1.setSelected(false);Passcode2.setSelected(false);Passcode3.setSelected(false);Passcode4.setSelected(false);butNumpadLogin.setEnabled(false)},Logon:function(){var e=CryptoJS.AES.decrypt(AppCache.Encrypted,NumPad.numValue);try{var t=e.toString(CryptoJS.enc.Utf8)}catch(n){t=""}if(t==""){NumPad.Clear();if(AppCache.numPasscode==NumPad.numPasscode){NumPad.numPasscode=0;AppCache.Logout();AppCache.RemoveAllCache();return}jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(AppCacheText.noPasscodeMatch);NumPad.numPasscode++;return}if(AppCache.enableEncryption===true&&AppCache.enablePasscode===true){AppCache.decryptDB()}if(AppCache.enablePortal==true){AppCache.Auth=t;AppCache.PortalRelog();return}$.ajaxSetup({headers:{Authorization:t,"sap-client":AppCache.Client,"X-SUP-APPCID":AppCache.deviceID,"Access-Control-Allow-Origin":"*"}});NumPad.numPasscode=0;NumPad.Clear();NumPad.Verify=true;if(AppCache.enableTwoFactor===true){var r=ModelData.Find(AppCacheUsers,"UNAME",AppCache.CurrentUname);if(r[0].TWOFACTOR===""){AppCache_inTwoFactor.setValue();AppCache_popTwoFactor.open();setTimeout(function(){AppCache_inTwoFactor.focus()},200);return}}AppCache.Encrypted="";AppCache.Update()}};$(document).ajaxError(function(e,t,n){sap.ui.core.BusyIndicator.hide();switch(t.status){case 0:var r=!!window.Windows&&/^ms-appx:/.test(location.href);if(r==true){if(t.statusText.indexOf("resource")>-1){}else{jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(AppCacheText.noConnection);if(AppCache.CurrentApp==AppCache.PasscodeApp){AppCache.Load(AppCache.StartApp)}}}else{jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(AppCacheText.noConnection);if(AppCache.CurrentApp==AppCache.PasscodeApp){AppCache.Load(AppCache.StartApp)}}break;case 401:if(AppCache.enableSMP==false){AppCache.Logout()}break;case 404:break;case 200:var i=t.getResponseHeader("SAPLoginStatus");switch(i){case"Password":AppCache.Logout();return;case"Logon":if(AppCache.enablePortal==true){AppCache.PortalRelog()}else{AppCache.Logout()}return};default:jQuery.sap.require("sap.m.MessageToast");sap.m.MessageToast.show(t.status+" - "+t.statusText)}})